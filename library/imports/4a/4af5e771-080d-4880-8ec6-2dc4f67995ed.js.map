{"version":3,"sources":["..\\..\\..\\..\\assets\\Script/assets\\Script\\Game.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["import { FishState, FishType } from './FishType';\r\nimport Fish from './Fish';\r\nimport Bullet from './Bullet';\r\nimport Net from './Net';\r\nimport CoinController from './CoinController';\r\nimport Weapon from './Weapon';\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Game extends cc.Component {\r\n    //鱼对象池\r\n    fishPool: cc.NodePool;\r\n    fishTypes: FishType[];\r\n\r\n    @property(cc.Prefab)\r\n    fishPrefab: cc.Prefab = null;\r\n\r\n    @property(cc.Node)\r\n    weaponNode: cc.Node = null;    \r\n\r\n    @property(cc.Prefab)\r\n    bulletPrefab: cc.Prefab = null;\r\n\r\n    @property(cc.Prefab)\r\n    netPrefab: cc.Prefab = null;\r\n\r\n    @property(cc.Node)\r\n    coinController: cc.Node = null;\r\n    \r\n    @property(cc.SpriteAtlas)\r\n    spAtlas: cc.SpriteAtlas = null;\r\n\r\n    @property(cc.Node)\r\n    gameOverNode: cc.Node = null;\r\n\r\n    oneFish: cc.Node;\r\n    oneBullet: cc.Node;\r\n    oneNet: cc.Node;\r\n\r\n    //子弹对象池\r\n    bulletPool: cc.NodePool;\r\n    netsPool: cc.NodePool;\r\n\r\n    onLoad() {\r\n        let manager = cc.director.getCollisionManager();\r\n        manager.enabled = true;\r\n        // manager.enabledDebugDraw = true;\r\n        // manager.enabledDrawBoundingBox = true;\r\n\r\n        this.bulletPool = new cc.NodePool(Bullet);\r\n        this.fishPool = new cc.NodePool(Fish);\r\n        // 池子里面多放几条鱼\r\n        let initCount = 10;\r\n        for (let i = 0; i < initCount; ++i){\r\n            let fishPre = cc.instantiate(this.fishPrefab);\r\n            this.fishPool.put(fishPre);\r\n        }\r\n        this.netsPool = new cc.NodePool();\r\n\r\n        this.coinController.getComponent(CoinController).init();\r\n        this.weaponNode.getComponent(Weapon).init();\r\n        // 设置zorder，控制显示层级\r\n        // 背景在最下层，最上层是炮台\r\n        // 中间层是鱼\r\n        cc.find('Canvas/game_bg').setLocalZOrder(-1);\r\n        cc.find('Canvas/bottomBar').setLocalZOrder(1);\r\n        this.gameOverNode.setLocalZOrder(2);\r\n        this.gameOverNode.active = false;\r\n\r\n        let self = this;\r\n        cc.director.setDisplayStats(true);\r\n        // 动态加载json配置文件\r\n        cc.loader.loadRes(\"fishconfig\", function (err, data) {\r\n            if (err) {\r\n                cc.error(err.message || err);\r\n                return;\r\n            }\r\n            // 加载之后转类型\r\n            self.fishTypes = <FishType[]>data;\r\n            self.schedule(self.creatFish, 2);\r\n        });\r\n\r\n\r\n\r\n        // 添加触摸事件\r\n        this.node.on(cc.Node.EventType.TOUCH_START, function (event: cc.Event.EventTouch) { \r\n            //需要将触点坐标转换成局部坐标，跟炮台一致\r\n            let touchPos = self.weaponNode.parent.convertTouchToNodeSpaceAR(event.touch);\r\n            let weaponPos = self.weaponNode.getPosition();\r\n            if (touchPos.y < weaponPos.y) return;\r\n            let radian = Math.atan((touchPos.x - weaponPos.x) / (touchPos.y - weaponPos.y));\r\n            let degree = radian * 180 / 3.14;\r\n            self.weaponNode.rotation = degree;\r\n            let bulletLevel = self.weaponNode.getComponent(Weapon).curLevel;\r\n            self.shot(bulletLevel);\r\n        }, this);\r\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, function (event) {\r\n            // cc.log('touch move');\r\n        }, this);\r\n        this.node.on(cc.Node.EventType.TOUCH_END, function (event) {\r\n            // cc.log('touch end');\r\n        }, this);\r\n\r\n\r\n    }\r\n\r\n    shot(level:number) {\r\n        if (this.bulletPool.size() > 0) {\r\n            this.oneBullet = this.bulletPool.get(this);\r\n        } else {\r\n            this.oneBullet = cc.instantiate(this.bulletPrefab);\r\n        }\r\n        // 剩余金币\r\n        let left = this.coinController.getComponent(CoinController).reduceCoin(level);\r\n        if (left) {\r\n            this.oneBullet.getComponent(Bullet).shot(this, level);\r\n        } else {\r\n            if (this.coinController.getComponent(CoinController).currentValue == 0) {\r\n                this.gameOver();\r\n            }\r\n        }\r\n        \r\n    }\r\n\r\n    creatFish() {\r\n        /**\r\n        if (this.fishPool.size() > 0) {\r\n            this.oneFish = this.fishPool.get(this);\r\n        } else {\r\n            this.oneFish = cc.instantiate(this.fishPrefab);\r\n        }\r\n        this.oneFish.getComponent(Fish).init(this);\r\n        */\r\n       //一次创建3条鱼\r\n        \r\n        let fishCount = 3;\r\n        for (let i = 0; i < fishCount; ++i){\r\n            let cfish: cc.Node = null; \r\n            if (this.fishPool.size() > 0) {\r\n                cfish = this.fishPool.get(this);\r\n            } else {\r\n                cfish = cc.instantiate(this.fishPrefab); \r\n            }\r\n           cfish.getComponent(Fish).init(this);\r\n        }\r\n         \r\n        \r\n    }\r\n\r\n\r\n    castNet(position:cc.Vec2) {\r\n        if (this.netsPool.size() > 0) {\r\n            this.oneNet = this.netsPool.get(this);\r\n        } else {\r\n            this.oneNet = cc.instantiate(this.netPrefab);\r\n        }\r\n        let bulletLevel = this.weaponNode.getComponent(Weapon).curLevel;\r\n        this.oneNet.getComponent(Net).init(position,this,bulletLevel);\r\n    }\r\n\r\n    despawnFish(fish: cc.Node) {\r\n        this.fishPool.put(fish);\r\n    }\r\n\r\n    despawnBullet(bullet:cc.Node) {\r\n        this.bulletPool.put(bullet);\r\n    }\r\n\r\n    despawnNet(net: cc.Node) {\r\n        this.netsPool.put(net);\r\n    }\r\n\r\n    gainCoins(coinPos: cc.Vec2, value: number) {\r\n        this.coinController.getComponent(CoinController).gainCoins(coinPos, value);\r\n    }\r\n\r\n    gameOver() {\r\n        this.gameOverNode.active = true;\r\n        this.unscheduleAllCallbacks();\r\n    }\r\n\r\n    gameRestart() {\r\n        // cc.game.restart();\r\n        cc.director.loadScene('mainscene');\r\n    }\r\n}\r\n"]}