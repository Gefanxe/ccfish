{"version":3,"sources":["CoinController.ts"],"names":[],"mappings":";;;;;AAAA,iCAA4B;AAC5B,iCAA4B;AACtB,IAAA,kBAAqC,EAAnC,oBAAO,EAAE,sBAAQ,CAAmB;AAG5C;IAA4C,kCAAY;IADxD;QAAA,qEAuHC;QAnHG,oBAAc,GAAc,IAAI,CAAC;QAGjC,iBAAW,GAAc,IAAI,CAAC;QAG9B,aAAO,GAAc,IAAI,CAAC;QAG1B,aAAO,GAAc,IAAI,CAAC;QAG1B,aAAO,GAAc,IAAI,CAAC;QAG1B,aAAO,GAAc,IAAI,CAAC;QAG1B,aAAO,GAAc,IAAI,CAAC;QAG1B,aAAO,GAAc,IAAI,CAAC;QAG1B,gBAAU,GAAmB,IAAI,CAAC;QAGlC,kBAAY,GAAW,CAAC,CAAC;QAGzB,aAAO,GAAW,CAAC,CAAC;;IAqFxB,CAAC;IA1EG,wBAAwB;IAExB,+BAAM,GAAN;IAEA,CAAC;IAED,6BAAI,GAAJ;QACI,IAAI,CAAC,UAAU,GAAG,IAAI,EAAE,CAAC,QAAQ,EAAE,CAAC;QACpC,IAAI,CAAC,SAAS,GAAG,IAAI,EAAE,CAAC,QAAQ,EAAE,CAAC;QACnC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;IACrC,CAAC;IAED,qBAAqB;IACrB,sCAAa,GAAb,UAAc,GAAW,EAAE,MAAc;QACrC,MAAM,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,CAAC;IAC1D,CAAC;IAED,iCAAQ,GAAR,UAAS,KAAa;QAClB,IAAI,GAAG,GAAG,IAAI,CAAC,aAAa,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;QACvC,IAAI,IAAI,GAAG,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;QACzB,IAAI,CAAC,OAAO,CAAC,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC;QAC9E,IAAI,CAAC,OAAO,CAAC,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC;QAC9E,IAAI,CAAC,OAAO,CAAC,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC;QAC9E,IAAI,CAAC,OAAO,CAAC,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC;QAC9E,IAAI,CAAC,OAAO,CAAC,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC;QAC9E,IAAI,CAAC,OAAO,CAAC,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC;IAClF,CAAC;IAED,SAAS;IACT,iCAAQ,GAAR,UAAS,KAAa;QAClB,IAAI,CAAC,YAAY,IAAI,KAAK,CAAC;QAC3B,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;IACrC,CAAC;IAED,WAAW;IACX,mCAAU,GAAV,UAAW,KAAa;QACpB,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,IAAI,KAAK,CAAC,CAAC,CAAC;YAC7B,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,IAAE,KAAK,CAAC,CAAC;YACxC,MAAM,CAAC,IAAI,CAAC;QAChB,CAAC;QAED,MAAM,CAAC,KAAK,CAAC;IACjB,CAAC;IAED,kCAAS,GAAT,UAAU,OAAgB,EAAE,OAAe;QACvC,WAAW;QACX,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC;YAC7B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,CAAC;QACzC,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QACvD,CAAC;QAED,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,eAAK,CAAC,CAAC,IAAI,CAAC,OAAO,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC;QAE9D,QAAQ;QACR,EAAE,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC;YAC5B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC;QACxC,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QACpD,CAAC;QACD,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,eAAK,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC5C,SAAS;QACT,IAAI,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACxE,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,eAAK,CAAC,CAAC,MAAM,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;QACxD,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;IAC3B,CAAC;IAED,qCAAY,GAAZ,UAAa,IAAY;QACrB,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;IAC7B,CAAC;IAED,sCAAa,GAAb,UAAc,GAAW;QACrB,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;IAC7B,CAAC;IAlHD;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;0DACa;IAGjC;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;uDACU;IAG9B;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;mDACM;IAG1B;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;mDACM;IAG1B;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;mDACM;IAG1B;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;mDACM;IAG1B;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;mDACM;IAG1B;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;mDACM;IAG1B;QADC,QAAQ,CAAC,EAAE,CAAC,WAAW,CAAC;sDACS;IAGlC;QADC,QAAQ;wDACgB;IAGzB;QADC,QAAQ;mDACW;IAjCH,cAAc;QADlC,OAAO;OACa,cAAc,CAsHlC;IAAD,qBAAC;CAtHD,AAsHC,CAtH2C,EAAE,CAAC,SAAS,GAsHvD;kBAtHoB,cAAc","file":"","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["import Coins from './Coins';\r\nimport NumUp from './NumUp';\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class CoinController extends cc.Component {\r\n\r\n    @property(cc.Prefab)\r\n    coinPlusPrefab: cc.Prefab = null;\r\n\r\n    @property(cc.Prefab)\r\n    coinsPrefab: cc.Prefab = null;\r\n\r\n    @property(cc.Sprite)\r\n    number1: cc.Sprite = null;\r\n\r\n    @property(cc.Sprite)\r\n    number2: cc.Sprite = null;\r\n\r\n    @property(cc.Sprite)\r\n    number3: cc.Sprite = null;\r\n\r\n    @property(cc.Sprite)\r\n    number4: cc.Sprite = null;\r\n\r\n    @property(cc.Sprite)\r\n    number5: cc.Sprite = null;\r\n\r\n    @property(cc.Sprite)\r\n    number6: cc.Sprite = null;\r\n\r\n    @property(cc.SpriteAtlas)\r\n    timerAtlas: cc.SpriteAtlas = null;\r\n\r\n    @property\r\n    currentValue: number = 0;\r\n\r\n    @property\r\n    toValue: number = 0;\r\n\r\n    coinUpPool: cc.NodePool;\r\n    coinsPool: cc.NodePool;\r\n\r\n    // +金币数字\r\n    coin_up: cc.Node;\r\n\r\n    // 获得金币\r\n    oneCoin: cc.Node;\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad() {\r\n\r\n    }\r\n\r\n    init() {\r\n        this.coinUpPool = new cc.NodePool();\r\n        this.coinsPool = new cc.NodePool();\r\n        this.setValue(this.currentValue);\r\n    }\r\n\r\n    // 数字固定长度lenght，不够的补0\r\n    prefixInteger(num: number, length: number) {\r\n        return (Array(length).join('0') + num).slice(-length);\r\n    }\r\n\r\n    setValue(value: number) {\r\n        let str = this.prefixInteger(value, 6);\r\n        let nums = str.split('');\r\n        this.number1.spriteFrame = this.timerAtlas.getSpriteFrame(nums[0].toString());\r\n        this.number2.spriteFrame = this.timerAtlas.getSpriteFrame(nums[1].toString());\r\n        this.number3.spriteFrame = this.timerAtlas.getSpriteFrame(nums[2].toString());\r\n        this.number4.spriteFrame = this.timerAtlas.getSpriteFrame(nums[3].toString());\r\n        this.number5.spriteFrame = this.timerAtlas.getSpriteFrame(nums[4].toString());\r\n        this.number6.spriteFrame = this.timerAtlas.getSpriteFrame(nums[5].toString());\r\n    }\r\n\r\n    // 获取金币加数\r\n    addCoins(value: number) {\r\n        this.currentValue += value;\r\n        this.setValue(this.currentValue);\r\n    }\r\n\r\n    // 发射子弹消耗金币\r\n    reduceCoin(level: number): boolean{\r\n        if (this.currentValue >= level) {\r\n            this.setValue(this.currentValue-=level);\r\n            return true;\r\n        } \r\n        \r\n        return false;\r\n    }\r\n\r\n    gainCoins(coinPos: cc.Vec2, coinnum: number) {\r\n        // 上升的数字对象池\r\n        if (this.coinUpPool.size() > 0) {\r\n            this.coin_up = this.coinUpPool.get();\r\n        } else {\r\n            this.coin_up = cc.instantiate(this.coinPlusPrefab);\r\n        }\r\n\r\n        this.coin_up.getComponent(NumUp).init(coinPos, coinnum, this);\r\n\r\n        // 金币对象池\r\n        if (this.coinsPool.size() > 0) {\r\n            this.oneCoin = this.coinsPool.get();\r\n        } else {\r\n            this.oneCoin = cc.instantiate(this.coinsPrefab);\r\n        }        \r\n        this.oneCoin.getComponent(Coins).init(this);\r\n        // 转为世界坐标\r\n        let toPos = this.node.convertToWorldSpaceAR(this.number3.node.position);\r\n        this.oneCoin.getComponent(Coins).goDown(coinPos, toPos);\r\n        this.addCoins(coinnum);\r\n    }\r\n\r\n    despawnCoins(coin:cc.Node) {\r\n        this.coinsPool.put(coin);\r\n    }\r\n\r\n    despawnCoinup(nup:cc.Node) {\r\n        this.coinUpPool.put(nup);\r\n    }\r\n}\r\n"]}