{"version":3,"sources":["Bullet.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["import Game from './Game';\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Bullet extends cc.Component {\r\n    // 子弹初始角度\r\n    angle: number = 0;\r\n\r\n    game: Game;\r\n\r\n    // 子弹攻击力，基础攻击力\r\n    private attack: number = 4;\r\n\r\n    // 子弹速度\r\n    @property\r\n    speed: number = 10;  \r\n\r\n    bulletLeve: number = 1;\r\n\r\n    shot(game: Game, level: number) {\r\n        this.game = game;\r\n        // 启动update函数\r\n        this.enabled = true;\r\n        let weaponSite = game.weaponNode.parent.convertToWorldSpaceAR(game.weaponNode.getPosition());\r\n        this.angle = game.weaponNode.rotation;\r\n        this.node.rotation = this.angle;\r\n        let bpos = cc.p(weaponSite.x + 50 * Math.sin(this.angle / 180 * 3.14), weaponSite.y + 50 * Math.cos(this.angle / 180 * 3.14));\r\n        this.setBullet(level);\r\n        this.node.position = bpos;\r\n        this.node.parent = cc.director.getScene();\r\n    }\r\n\r\n    // 根据武器等级设置子弹等级\r\n    setBullet(level: number) {\r\n        this.bulletLeve = level;\r\n        this.node.getComponent(cc.Sprite).spriteFrame = this.game.spAtlas.getSpriteFrame('bullet' + this.bulletLeve);\r\n    }\r\n\r\n    update(dt) {\r\n        let bx = this.node.x;\r\n        let by = this.node.y;\r\n        bx += dt * this.speed * Math.sin(this.angle / 180 * 3.14);\r\n        by += dt * this.speed * Math.cos(this.angle / 180 * 3.14);\r\n        this.node.x = bx;\r\n        this.node.y = by;\r\n\r\n        if (this.node.x > cc.director.getWinSize().width + 100\r\n            || this.node.x < -100\r\n            || this.node.y > cc.director.getWinSize().height + 100\r\n            || this.node.y < 0\r\n        ) {\r\n            this.game.despawnBullet(this.node);\r\n        }\r\n    }\r\n    onCollisionEnter(other, self) {\r\n        // 矩形碰撞组件顶点坐标，左上，左下，右下，右上\r\n        let posb = self.world.points;\r\n        // 取左上和右上坐标计算中点当做碰撞中点\r\n        let posNet = cc.pMidpoint(posb[0], posb[3]);\r\n        this.game.castNet(posNet);\r\n        this.game.despawnBullet(this.node);\r\n    }\r\n\r\n    getAttackValue():number {\r\n        return this.attack * this.bulletLeve;\r\n    }\r\n}\r\n"]}